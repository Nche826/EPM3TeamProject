<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafe24.epm.mapper.StaffMapper">


	<resultMap type="Staff" id="StaffSelect">
   			<result property="staff_code" 	column="staff_code"/>
   			<result property="staff_id" 	column="staff_id"/>
   			<result property="store_code" 	column="store_code"/>
   			<result property="store_name" 	column="store_name"/>
   			<result property="staff_level" 	column="staff_level"/>
   			<result property="staff_reg_id" 	column="staff_reg_id"/>
   			<result property="staff_reg_date" 	column="staff_reg_date"/>
   	</resultMap>
   	
   	
	<insert id="addStaff" parameterType="staff">
		<selectKey order="BEFORE" keyProperty="staff_code" resultType="String" >
	    	select
		    	(case COUNT(*)
		 			when 0 then 'staff_1'
			    	else concat('staff_',Max(cast(SUBSTR(staff_code,7) AS DECIMAL))+1)
			    	end) as staff_code
	    	from
	    	  	tb_staff as s
		</selectKey> 
	INSERT INTO tb_staff
		(staff_code
		,member_id
		,store_code
		,level_code
		,member_reg_id
		,staff_reg_date)
	VALUES 
		(#{staff_code}
		,#{staff_id}
		,#{store_name}
		,#{staff_level}
		,#{staff_reg_id}
		, NOW())
	</insert>



</mapper>